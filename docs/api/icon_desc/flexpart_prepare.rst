Generates the gridded input data and the AVAILABLE file needed to run the `FLEXPART <https://confluence.ecmwf.int/display/METV/The+FLEXPART+interface>`_  Lagrangian dispersion model. The input forecast or analysis fields are either automatically retrieved from ECMWF's MARS archive or read from the specified input file. 

.. tip:: A tutorial on using FLEXPART from within Metview is available `here <https://confluence.ecmwf.int/display/METV/Using+FLEXPART+with+Metview>`_.

**What data is available?**

:func:`flexpart_prepare` is currently only able to handle data from the operational ECMWF forecasts/analyses 2008, 4 June onwards.

**Input data fields**

The following is for information only - :func:`flexpart_prepare` handles these details internally.

FLEXPART requires input fields on a regular latitude-longitude grid in GRIB format. The input data must contain five three-dimensional fields: the two horizontal wind components, vertical velocity, temperature and specific humidity. Additional surface fields (e.g. fluxes) are also needed. The three-dimensional input data has to be available on ECMWF model (i.e. :math:`\eta`) levels defined by a hybrid vertical coordinate system. An important restriction is that all the data fields used within a FLEXPART run must have the same domain size, resolution, number of levels, etc.

All the required fields, with one exception, can be retrieved from ECMWF's MARS archive. The only exception is vertical velocity because FLEXPART needs the following field for its computations: :math:`\dot \eta \frac{\partial \eta}{\partial p}`. Since only :math:`\dot \eta` is archived in MARS the full product needs to be computed during the data preparation process (:func:`flexpart_prepare` does it for you).

**Input filenames**

FLEXPART requires all the input GRIB files to be in the same folder using the following file naming convention: **EN**\ *yymmddhh*\ . The same directory has to contain the AVAILABLE file as well (it is automatically generated by :func:`flexpart_prepare`).