Generates the gridded input data and the AVAILABLE file needed to run the `FLEXTRA <https://confluence.ecmwf.int/display/METV/The+FLEXPART+interface>`_ trajectory model. The input forecast or analysis fields are either automatically retrieved from ECMWF's MARS archive or read from the specified input file. 

.. tip:: A tutorial on using FLEXTRA from within Metview is available `here <https://confluence.ecmwf.int/display/METV/FLEXTRA+tutorial>`_.

**What data is available?**

:func:`flextra_prepare` is currently only able to handle data from the operational ECMWF forecasts/analyses 2008, 4 June onwards.

**About the FLEXTRA input data**

The following is for information only - :func:`flextra_prepare` handles these details internally.

FLEXTRA requires input fields on a regular latitude-longitude grid in GRIB format. The input data must contain four three-dimensional fields: the two horizontal wind components, vertical velocity and temperature. Two additional two-dimensional fields are needed as well: topography and surface pressure. The three-dimensional input data has to be available on ECMWF model (i.e. :math:`\eta`) levels defined by a hybrid vertical coordinate system. An important restriction is that all the data fields used within a FLEXTRA run must have the same domain size, resolution, number of levels, etc.

All the required fields, with one exception, can be retrieved from ECMWF's MARS archive. The only exception is vertical velocity because FLEXTRA needs the following field for its computations: :math:`\dot \eta \frac{\partial \eta}{\partial p}`. Since only :math:`\dot \eta` is archived in MARS the full product needs to be computed during the data preparation process (:func:`flextra_prepare` does it for you).


FLEXTRA requires all the input GRIB files to be in the same folder using the following file naming convention: **EN**\ *yymmddhh*\ . In addition to the GRIBs FLEXTRA needs several parameter files as well. Most of these files are automatically generated by Metview in the background, so users do not need to create them. The only exception is the file called AVAILABLE because it can be optionally provided by the user.